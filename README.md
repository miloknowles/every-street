# :runner: Running Every Street (in Cambridge)

See the app [here](https://everystreet.herokuapp.com/).

![Cambridge street map](/static/cambridge.png)

## :runner: Getting Strava Access Tokens

First, you need to get an authentication code from Strava.

Put this URL in the browser:
```
https://www.strava.com/oauth/authorize?client_id=77280&response_type=code&redirect_uri=http://www.miloknowles.com&approval_prompt=force&scope=read_all,profile:read_all,activity:read_all
```

Notice that it requests several scopes of access, so that we can use the same token for every action needed. More info on scopes is [here](https://developers.strava.com/docs/authentication/).

```bash
# Copy the OAuth2 code into this POST request. You'll be able to execute the request once, and should get an access token in the JSON response.
curl -X POST https://www.strava.com/api/v3/oauth/token \
  -d client_id=77280 \
  -d client_secret=SOME_VALUE \
  -d code=SOME_VALUE \
  -d grant_type=authorization_code
```

Then you'll get a JSON response with a `refresh_token` and an `access_token`.

## :computer: Heroku

https://dashboard.heroku.com/apps/everystreet

```bash
# Run locally. This will load in the .env file variables.
heroku local

python app.py # If you want hot-reloading to work.

# Deploys to the remote app on Heroku.
git push heroku main

# Check the logs.
heroku logs --tail
```

## :fire: Google Firebase

https://console.firebase.google.com/u/2/project/runningheatmap-a5864/overview

To encode a `serviceAccountKey.json` into a string:
```bash
openssl base64 -in .serviceAccountKey.json -out firebaseConfigBase64.txt -A
```

## :scroll: Cambridge GeoJson

I downloaded the shapefile from [here](https://www.cambridgema.gov/GIS/gisdatadictionary/Boundary/BOUNDARY_CityBoundary).

Convert using [this tool](http://ogre.adc4gis.com/), and make sure to specify `EPSG:4326` as the target SRS.


FIREBASE_KEY_BASE64=ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAicnVubmluZ2hlYXRtYXAtYTU4NjQiLAogICJwcml2YXRlX2tleV9pZCI6ICJkYjg0NDk4ODllNjA5MzE4ZDlmNjhiZTFkNjNjOTM3OWM4Mzc0YzYyIiwKICAicHJpdmF0ZV9rZXkiOiAiLS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tXG5NSUlFdmdJQkFEQU5CZ2txaGtpRzl3MEJBUUVGQUFTQ0JLZ3dnZ1NrQWdFQUFvSUJBUUNpS2pXazFLMUpKVnhVXG5NY0Y1WjZCMHZtbWJCQVBQRjlVZ2ZBMEVKb0ljb2RsZ3dTK2FuelRvK1RlVzd3QzRMeVZ6d3Z1OXo5RUtFVWxGXG5QMkQ0ZzBZYUpjcVFVbUkyZzZQeCtCbU5zR1NQNDdjTnVNOGhxMDZUU083WXB4S2dndnJqVzNhaFJFYUNwY0w4XG5NU2NCcnk3ZUp5dW8rc3dpZ0o2Rks3dzhHY3BsN0FhWXIvUll1cHhWY3hjVTg4OTVrQVg0clo1TElJUXhvUUlrXG5wcmFKdnpOSkloUzhwcFB2U2hjdGxrMkdkOVlId2RVWUJLb2xXZERaalRGZTRkOTd2dnlwUUFHcFZ0RW1wUXRBXG5iRGxVUHczTGNETWJvNU1TMDIxaFhaZDRVTkNXQmVMam9PalNnVVNnOVloL0RWOVplUjNjQ0c2VjJiVitZbGNHXG50YXhUS2IrQkFnTUJBQUVDZ2dFQUdxa1MyYThIY0RPZXVzN1ZUcGJkVitRb0s0NmM2N0t3M043WUt2c0R3QjVSXG54U2p0b1IrVWpNclFPMVcreWdraVFLWnBTZHI5TklrRUFVajZzZEN2T1VSR1NiVHBwYW05emQycW9kTkNyUzlVXG5YSUtxTnhCWllqaUc0QUtUdXVUZHgzdzFoQ3piNU1YSXlUcHhmY0xsMHlzZ2IrOFBtWXFJeFQ4YitzdUlyWG05XG4xaGV0Vjc2VUVlSTQ5aDdvRWtFNVVla1Eyd25yV3dwUFVSUzRnVlZqOVBVQUNhajM2ZjZ2ejNkOFdkYnY2a3NLXG5Bc0pSenZvRkxzd0tlMHMwenRqRXRMRWFoRjFQM2dUMEFlNGljUHpwNm5rODJ0M293Wmw2NVUxeXdiV3c4dFpZXG5ZK2FGTU5CTSttbGk1MmFSVHFWMjdaN0w4b2tzVHErS0ZETkUwWUtydVFLQmdRRFF0SEREKzRuYUQ2N1VYUk5UXG5BMTlPdloxQjJ0REtBQlV6dmVudEh5Y0FGa28yWTZsVW1CQzVmR2RpTHBjbno4V3FQN2huSkdKR04xeTdUR2lmXG5xaGFoakppSzloeTFPcDJwMnRZK05FaU9ZellnUjNWYVJoc3B0cXovMjY5aEl1MHVUN0ZtaTZnR0x0aTl4M3RWXG5idmNTVW80dGJ2VktDL25DMjdlM3BqdFRSUUtCZ1FERzZkcVVYdk5ZSFZnaUtNQkFYb3JTc2FESFd2ZjJDNkluXG4zeGVDOUpVQ1lEYXVvbFhxME90ZC8xSjkrQnRmZ2tWcFg2WlBUZWUvMWdvdGRFbk1iYUNHbXU0ZTBEZlBqTlBiXG5UNmIxMi9FbmJXRUxNQVNPWHRNNFRZZ0ZYZEtqWFRUdE55VFAxU3VIY1ZUa3BPSlJjNlNqTjdQdUNFQktiSlJCXG5RSjMzT1JwQkRRS0JnUUM4NUFNSHJmcVhMUWlMMWUydWZXZmVTVWt5R0V4Tjl3TTVnRkpmTlluRHoyaTlqemZyXG5nM0hubnd1bTFnb2lreThRcG5sTWlLYVZiSGYyWVBKMFI2b1I3c0VGVERpeFllcmVsMXkra2UxMVNaL3NXU0NDXG5ZdDhrd3R3UytnN2lPSTA0RkJLNGYvL0VFTlJEOTI3TjVRK2pPcXJKdmhvdE9XZUZELzFZTHhDVWpRS0JnUUNnXG55NVlvYm9Fa2I4UTVDTnd3ckx4b0NiTkF0R2JSL1NGK1BiZVI0d2s1dkhFM3huN1JyVVUyM1JqZ1A5cFE0TXdmXG5uSFNpa3dXT2JBWWFMSEVqMGxMN3ZPNVU5bGpIYkw0dUFUdWtiOEdINzhHTSs2b1ROTkJtS1RhVnIveUFsdTRiXG4vSUhEaUQwQjVqbU1BMFg0TmhXVzQ0YU9HeGx0a0V4Z1cwM1c5ZEFsV1FLQmdBc3REdFYxYUJJbUg2ZCtvbVdRXG5oWXkvRzQrcUo3ancrNHJzVEo4MnFzOTROSXBKdjZMRUpVNnJ3Y2h5NUdZMTdwV3lhekJkVWZYT0x1Ym92MFltXG5GMUV0TURRR3d6YldiTklVSFk1UGlabitXTWJoTGNsUktzekFFM2UzZkc1aHJPd1AyRzAzRlJzZUkyLzdBdWlMXG54d0NVcWw5dGJLcUtaMmEwbDV5Zno5SVNcbi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS1cbiIsCiAgImNsaWVudF9lbWFpbCI6ICJmaXJlYmFzZS1hZG1pbnNkay0xdG4zcUBydW5uaW5naGVhdG1hcC1hNTg2NC5pYW0uZ3NlcnZpY2VhY2NvdW50LmNvbSIsCiAgImNsaWVudF9pZCI6ICIxMDc3Njk4NTMwMDA5MjQ0MjAwMTAiLAogICJhdXRoX3VyaSI6ICJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20vby9vYXV0aDIvYXV0aCIsCiAgInRva2VuX3VyaSI6ICJodHRwczovL29hdXRoMi5nb29nbGVhcGlzLmNvbS90b2tlbiIsCiAgImF1dGhfcHJvdmlkZXJfeDUwOV9jZXJ0X3VybCI6ICJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9vYXV0aDIvdjEvY2VydHMiLAogICJjbGllbnRfeDUwOV9jZXJ0X3VybCI6ICJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9yb2JvdC92MS9tZXRhZGF0YS94NTA5L2ZpcmViYXNlLWFkbWluc2RrLTF0bjNxJTQwcnVubmluZ2hlYXRtYXAtYTU4NjQuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iCn0K
